{"version":3,"sources":["main.js"],"names":["Site","mobileThreshold","init","_this","this","Router","$","window","resize","onResize","document","ready","Shapes","Map","Minimap","Fades","Nav","fixWidows","each","string","html","replace","bind","on","reset","moveMap","width","height","resetContent","cleanUrl","location","hash","loadRoute","parseHash","addClass","setMenuActive","removeClass","$item","rawHash","substr","history","pushState","$mapPattern","$patterns","patternMin","patternMax","currentPattern","timer","interval","animating","showPattern","map","getElementById","addEventListener","startAnimation","stopAnimation","Math","floor","random","changePattern","playAnimation","currentTime","Date","getTime","delta","startTime","requestAnimationFrame","cancelAnimationFrame","panZoneSize","panSpeed","panDelay","panning","center","mouse","mapPosition","pointerInHeader","getWindowSize","geolocation","setPanZones","handleMouseMove","body","stopPanning","bindHeaderMouseOver","innerWidth","innerHeight","x","y","panZones","up","min","max","down","left","right","event","clientX","clientY","isInsidePanZone","triggerPanning","clearTimeout","delayTimeout","stopPanEvent","mouseOnHeader","posX","posY","setTimeout","startPanEvent","pan","CustomEvent","detail","position","dispatchEvent","angle","angleFromCenter","translation","distanceFromCenter","getElemPosition","newX","cos","newY","sin","WP","clientGeolocation","latitude","longitude","Number","translatedLongitude","translatedLatitude","console","log","style","transform","toString","moveIndicator","xs","pow","ys","distance","sqrt","dy","dx","theta","atan2","elem","transformMatrix","getComputedStyle","split","item","parseInt","headerChilds","querySelectorAll","i","length","child","mouseEntersHeader","mouseLeavesHeader","$textContent","$mapContent","isPanning","isHoveringText","handleMapPanning","handleTextHover","hover","minimapScale","indicatorPosition","minimapIndicator","bindClick","handleClick","col","attr","row","minimapX","minimapY"],"mappings":"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","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global $, jQuery, document, Site, Modernizr, WP */\n\nSite = {\n  mobileThreshold: 601,\n  init: function() {\n    var _this = this;\n\n    Site.Router.init();\n\n    $(window).resize(function(){\n      _this.onResize();\n    });\n\n    $(document).ready(function () {\n      Site.Shapes.init();\n      Site.Map.init();\n      Site.Minimap.init();\n      Site.Fades.init();\n      Site.Nav.init();\n    });\n\n  },\n\n  onResize: function() {\n    var _this = this;\n\n  },\n\n  fixWidows: function() {\n    // utility class mainly for use on headines to avoid widows [single words on a new line]\n    $('.js-fix-widows').each(function(){\n      var string = $(this).html();\n      string = string.replace(/ ([^ ]*)$/,'&nbsp;$1');\n      $(this).html(string);\n    });\n  },\n};\n\nSite.Nav = {\n  init: function() {\n    this.bind();\n  },\n\n  bind: function() {\n    var _this = this;\n\n    $('#header-name').on('click', function() {\n      _this.reset();\n    });\n  },\n\n  reset: function() {\n    Site.Map.moveMap(Site.Map.window.width * -1, Site.Map.window.height * -1);\n    Site.Router.resetContent();\n    Site.Router.cleanUrl();\n  },\n};\n\nSite.Router = {\n  init: function() {\n    var _this = this;\n\n    _this.bind();\n\n    if (location.hash) {\n      _this.loadRoute(_this.parseHash(location.hash));\n    }\n  },\n\n  bind: function() {\n    var _this = this;\n\n    $(window).on('hashchange', function() {\n      _this.loadRoute(_this.parseHash(location.hash));\n    });\n\n  },\n\n  loadRoute: function(hash) {\n    var _this = this;\n\n    if (hash) {\n      _this.resetContent();\n      $('.page-content[data-slug=\"' + hash + '\"]').addClass('page-content-active');\n\n      _this.setMenuActive(hash);\n    }\n  },\n\n  resetContent: function() {\n    $('.page-content').removeClass('page-content-active');\n    $('.header-menu-active').removeClass('header-menu-active');\n  },\n\n  setMenuActive: function(hash) {\n    var _this = this;\n\n    var $item = $('.header-menu-item[data-slug=\"' + hash + '\"]');\n\n    $('.header-menu-active').removeClass('header-menu-active');\n    $item.addClass('header-menu-active');\n  },\n\n  parseHash: function(rawHash) {\n    return rawHash.substr(3);\n  },\n\n  cleanUrl: function() {\n    window.location.hash = '';\n    history.pushState({}, '', './');\n  },\n};\n\nSite.Shapes = {\n  $mapPattern: $('.map-pattern'),\n  $patterns: [\n    $('#pattern-1'),\n    $('#pattern-2'),\n    $('#pattern-3'),\n    $('#pattern-4'),\n    $('#pattern-5'),\n  ],\n  patternMin: 0,\n  patternMax: 4,\n  currentPattern: 0,\n  timer: null,\n  interval: 1000,\n  animating: false,\n\n  init: function() {\n    var _this = this;\n\n    _this.showPattern();\n\n    var map = document.getElementById('map');\n\n    map.addEventListener('startpan', function() {\n      _this.startAnimation();\n    });\n\n    map.addEventListener('stoppan', function() {\n      _this.stopAnimation();\n    });\n\n  },\n\n  showPattern: function() {\n    var _this = this;\n\n    // Assign random current pattern array index\n    _this.currentPattern = Math.floor(Math.random() * (_this.patternMax - _this.patternMin + 1)) + _this.patternMin;\n\n    // Show current pattern\n    _this.$patterns[_this.currentPattern].addClass('show');\n  },\n\n  changePattern: function() {\n    var _this = this;\n\n    // Hide current pattern\n    _this.$mapPattern.removeClass('show');\n\n    // Assign next current pattern\n    if (_this.currentPattern >= _this.patternMax) {\n      // If last pattern, start from min index\n      _this.currentPattern = _this.patternMin;\n    } else {\n      // Else, assign next index\n      _this.currentPattern++;\n    }\n\n    // Show new current pattern\n    _this.$patterns[_this.currentPattern].addClass('show');\n  },\n\n  playAnimation: function() {\n    var _this = this;\n\n    // Check is animating has been stopped; we do this here to fail faster\n    if (!_this.animating) {\n      return false;\n    }\n\n    var currentTime = new Date().getTime();\n    var delta = currentTime - _this.startTime;\n\n    // If interval has passed since start time\n    if (delta >= _this.interval) {\n\n      // Change the background pattern\n      _this.changePattern();\n\n      // Reset start time\n      _this.startTime = new Date().getTime();\n    }\n\n    // Play loop recursively\n    _this.timer = window.requestAnimationFrame(_this.playAnimation.bind(_this));\n  },\n\n  startAnimation: function() {\n    var _this = this;\n\n    // Set initial start time\n    _this.startTime = new Date().getTime() - _this.interval;\n\n    _this.animating = true;\n\n    // Initialize animation loop\n    _this.playAnimation();\n  },\n\n  stopAnimation: function() {\n    var _this = this;\n\n    _this.animating = false;\n\n    // Clear animation request\n    window.cancelAnimationFrame(_this.timer);\n  },\n};\n\nSite.Map = {\n  panZoneSize: 150, // in pixels\n  panSpeed: 0.04,\n  panDelay: 100, // in ms\n  panning: false, // is it panning or not?\n  window: {},\n  center: {},\n  mouse: {},\n  mapPosition: false,\n  pointerInHeader: false,\n  init: function() {\n    var _this =  this;\n\n    // Set windowSize\n    _this.getWindowSize();\n\n    // Set map element\n    _this.map = document.getElementById('map');\n\n    // Move map to match geolocation\n    _this.geolocation();\n\n    // init pan zones\n    _this.setPanZones();\n\n    // Bind mouse position\n    document.addEventListener('mousemove', _this.handleMouseMove.bind(_this));\n\n    // Detect mouse outside window\n    document.body.addEventListener('mouseleave', _this.stopPanning.bind(_this));\n\n    // Bind hover event on #header\n    _this.bindHeaderMouseOver();\n\n  },\n\n  getWindowSize: function() {\n    var _this =  this;\n\n    // Save window size\n    _this.window = {\n      width: window.innerWidth,\n      height: window.innerHeight,\n    };\n\n    // Save window center\n    _this.window.center = {\n      x: _this.window.width / 2,\n      y: _this.window.height / 2,\n    };\n\n  },\n\n  // Set Up, Left, Down and Right pan zones based on window size\n  setPanZones: function() {\n    var _this =  this;\n\n    _this.panZones = {\n      up: {\n        min: 0,\n        max: _this.panZoneSize,\n      },\n      down: {\n        min: _this.window.height - _this.panZoneSize,\n        max: _this.window.height,\n      },\n      left: {\n        min: 0,\n        max: _this.panZoneSize,\n      },\n      right: {\n        min: _this.window.width - _this.panZoneSize,\n        max: _this.window.width,\n      },\n    };\n\n  },\n\n  handleMouseMove: function(event) {\n    var _this =  this;\n\n    // Save mouse position\n    _this.mouse.x = event.clientX;\n    _this.mouse.y = event.clientY;\n\n\n    if (_this.isInsidePanZone() && !_this.panning) {\n      _this.triggerPanning(); // Trigger animation\n    } else if (_this.panning && !_this.isInsidePanZone()) {\n      _this.stopPanning(); // Stop animation\n    }\n\n  },\n\n  stopPanning: function() {\n    var _this =  this;\n\n    _this.panning = false;\n\n    clearTimeout(_this.delayTimeout);\n\n    _this.stopPanEvent();\n\n  },\n\n  // (Bool) check if mouse is inside any pan zone\n  isInsidePanZone: function() {\n    var _this =  this;\n\n    // Check if mouse is over header or it's childs\n    if (_this.mouseOnHeader) {\n      return false;\n    }\n\n    // Get mouse position\n    var posX = _this.mouse.x;\n    var posY = _this.mouse.y;\n\n    // Check if mouse is inside panZones\n    if ( (posX >= _this.panZones.left.min && posX <= _this.panZones.left.max) || // Left\n      (posX >= _this.panZones.right.min && posX <= _this.panZones.right.max) || // Right\n      (posY >= _this.panZones.up.min && posY <= _this.panZones.up.max) || // Up\n      (posY >= _this.panZones.down.min && posY <= _this.panZones.down.max) ) //  Down\n    {\n      return true;\n    }\n\n    return false;\n\n  },\n\n  // Trigger panning animation\n  triggerPanning: function() {\n    var _this =  this;\n\n    _this.panning = true;\n\n    // We use a timeout to delay the triggering\n    _this.delayTimeout = setTimeout( function() {\n      _this.startPanEvent();\n      window.requestAnimationFrame(_this.pan.bind(_this));\n    }, _this.panDelay);\n\n  },\n\n  startPanEvent: function() {\n    var _this =  this;\n\n    var startPanEvent = new CustomEvent('startpan', {\n      detail: {\n        map: {\n          position: {\n            x: _this.mapPosition[4],\n            y: _this.mapPosition[5],\n          },\n        },\n      },\n    });\n\n    _this.map.dispatchEvent(startPanEvent);\n\n  },\n\n  stopPanEvent: function() {\n    var _this =  this;\n\n    var stopPanEvent = new CustomEvent('stoppan', {\n      detail: {\n        map: {\n          position: {\n            x: _this.mapPosition[4],\n            y: _this.mapPosition[5],\n          },\n        },\n      },\n    });\n\n    _this.map.dispatchEvent(stopPanEvent);\n\n  },\n\n  // Main panning logic\n  pan: function() {\n    var _this =  this;\n\n    // Check is panning has been stopped; we do this here to fail faster\n    if (!_this.panning) {\n      return false;\n    }\n\n    // Get the angle between center and mouse position\n    var angle = _this.angleFromCenter();\n\n    // Get the translation value based on mouse position from the center and speed\n    var translation = _this.distanceFromCenter() * _this.panSpeed;\n\n    // If we don't know the map's current postion we get it\n    if (!_this.mapPosition) {\n      _this.mapPosition = _this.getElemPosition(_this.map);\n    }\n\n    // Get new coordinates based on the angle and the translation value\n    var newX = _this.mapPosition[4] + (translation * Math.cos(angle));\n    var newY = _this.mapPosition[5] + (translation * Math.sin(angle));\n\n    // Move the map\n    _this.moveMap(newX,newY);\n\n    // Animate recursevly\n    window.requestAnimationFrame(_this.pan.bind(_this));\n\n  },\n\n  // Check if golocation is available and move the map to that equivalent location\n  geolocation: function() {\n    var _this =  this;\n\n    if (!WP.clientGeolocation) {\n      console.log('Geolocation not returned by the server');\n    } else if (WP.clientGeolocation.latitude && WP.clientGeolocation.longitude) {\n\n      // NOTES:\n      //\n      // # LONGITUDE\n      //\n      // Goes -180 to 180 deg. 0 is Greenwich. Negative is to the east,\n      // positive is west. In the map context it goes from 0 to\n      // _this.window.width * -2.\n      // Equivalent to the X axis\n      //\n      // # LATITUDE\n      //\n      // Goes from -90 to 90 deg. 0 deg is the equator, +- 90 deg are the\n      // poles. In the map context it goes from  0 to _this.window.height * -2\n      // Equivalent to the Y axis\n      //\n\n      // Turn strings into numbers\n      var longitude = Number(WP.clientGeolocation.longitude);\n      var latitude = Number(WP.clientGeolocation.latitude);\n\n      // Transport longitude to only positive values so it goes from 0 to 360\n      var translatedLongitude = longitude + 180;\n\n      // Transport latitude to only negative values so it goes from -180 to 0\n      var translatedLatitude = latitude - 90;\n\n      // Magic math, jk. It'ssic math.\n      var newX = (translatedLongitude * (_this.window.width * -2)) / 360;\n      var newY = (translatedLatitude * (_this.window.height * 2)) / 180;\n\n      // Move the map\n      _this.moveMap(newX,newY);\n    }\n  },\n\n\n  // Move the map to given coordinates\n  moveMap: function(x,y) {\n    var _this =  this;\n\n    // Check for left limit\n    if (x >= 0) {\n      x = 0;\n    }\n\n    // Check for right limit\n    if (x <= _this.window.width * -2) {\n      x = _this.window.width * -2;\n    }\n\n    // Check for upper limit\n    if (y >= 0) {\n      y = 0;\n    }\n\n    // Check for bottom limit\n    if (y <= _this.window.height * -2) {\n      y = _this.window.height * -2;\n    }\n\n\n    // If we don't know the map's current postion we get it\n    if (!_this.mapPosition) {\n      _this.mapPosition = _this.getElemPosition(_this.map);\n    }\n\n    // Set new coordinates\n    _this.mapPosition[4] = x;\n    _this.mapPosition[5] = y;\n\n    // Apply new coordinates\n    _this.map.style.transform = 'matrix(' + _this.mapPosition.toString() + ')';\n\n    // Move minimap position indicator\n    Site.Minimap.moveIndicator(x,y);\n  },\n\n  // Return distance between center and mouse positon in pixels\n  distanceFromCenter: function() {\n    var _this = this;\n\n    var xs = Math.pow(_this.window.center.x - _this.mouse.x, 2);\n    var ys = Math.pow(_this.window.center.y - _this.mouse.y, 2);\n    var distance = Math.sqrt(xs + ys);\n\n    return distance;\n  },\n\n  // Return angle in rad from center of the window and mouse position relative to X-axis\n  angleFromCenter: function() {\n    var _this = this;\n\n    var dy = _this.window.center.y - this.mouse.y;\n    var dx = _this.window.center.x - this.mouse.x;\n\n    var theta = Math.atan2(dy, dx); // range (-PI, PI]\n\n    return theta;\n  },\n\n  // Return current map postion\n  getElemPosition: function(elem) {\n    var _this = this;\n\n    // Get current element position (transform values)\n    var transformMatrix = getComputedStyle(elem).transform; // Returns a string like \"matrix(0,0,0,0,0,0)\"\n\n    // Get only the values as an array\n    transformMatrix = transformMatrix.replace(/3d|matrix|\\(|\\)|\\s|/g,'').split(','); // Returns an array like [\"0\",\"0\",\"0\",\"0\",\"0\",\"0\"]\n\n    // Parse string values into int values\n    transformMatrix = transformMatrix.map( function(item) {\n      return parseInt(item, 10);\n    }); // Returns an array like [0,0,0,0,0,0]\n\n    return transformMatrix;\n  },\n\n  bindHeaderMouseOver: function() {\n    var _this =  this;\n\n    // Detect mouse inside #header\n    var headerChilds = document.querySelectorAll('#header > *');\n\n    for (var i = 0; i < headerChilds.length; i++) {\n      var child = headerChilds[i];\n\n      child.addEventListener('mouseenter', _this.mouseEntersHeader.bind(_this));\n      child.addEventListener('mouseleave', _this.mouseLeavesHeader.bind(_this));\n    }\n\n  },\n\n  mouseEntersHeader: function() {\n    var _this = this;\n\n    _this.mouseOnHeader = true;\n  },\n\n  mouseLeavesHeader: function() {\n    var _this = this;\n\n    _this.mouseOnHeader = false;\n  },\n\n};\n\nSite.Fades = {\n  $textContent: $('#main-content'),\n  $mapContent: $('.map-block-content'),\n  isPanning: false,\n  isHoveringText: false,\n  init: function() {\n    var _this = this;\n\n    _this.handleMapPanning();\n    _this.handleTextHover();\n  },\n\n  handleMapPanning: function() {\n    var _this = this;\n\n    var map = document.getElementById('map');\n\n    map.addEventListener('startpan', function() {\n      _this.isPanning = true;\n\n      // Fadeout text content\n      _this.$textContent.addClass('fade-element');\n\n      // Fadein map content\n      _this.$mapContent.removeClass('fade-element');\n    });\n\n    map.addEventListener('stoppan', function() {\n      _this.isPanning = false;\n\n      // Fadein text content\n      _this.$textContent.removeClass('fade-element');\n\n      if (_this.isHoveringText) {\n        // If hovering text: fadeout map content\n        _this.$mapContent.addClass('fade-element');\n      }\n    });\n  },\n\n  handleTextHover: function() {\n    var _this = this;\n\n    _this.$textContent.hover(\n      function() {\n        _this.isHoveringText = true;\n\n        if (!_this.isPanning) {\n          // Mouseenter text content\n          // If not panning map: fadeout map content\n          _this.$mapContent.addClass('fade-element');\n        }\n      },\n      function() {\n        _this.isHoveringText = false;\n\n        // Mouseleave text content\n        // Fadein map content\n        _this.$mapContent.removeClass('fade-element');\n      }\n    );\n  },\n};\n\n\nSite.Minimap = {\n  minimapScale: 0.03,\n  indicatorPosition: false,\n  init: function() {\n    var _this = this;\n\n    // Set indicator element\n    _this.minimapIndicator = document.getElementById('minimap-indicator');\n\n    _this.bindClick();\n  },\n\n  bindClick: function() {\n    var _this = this;\n\n    // Bind click on minimap buttons\n    $('.minimap-button').on('click', function() {\n      // HANDLE IT\n      _this.handleClick(this);\n    });\n  },\n\n  handleClick: function(elem) {\n    var _this = this;\n\n    // Get grid position from target elem data attrs\n    var col = $(elem).attr('data-col');\n    var row = $(elem).attr('data-row');\n\n    // Multiply positions by window sizes to get new map coordinates\n    var x = col * Site.Map.window.width * -1;\n    var y = row * Site.Map.window.height * -1;\n\n    // Move map to new coordinates\n    // moveIndicator is called by this function\n    Site.Map.moveMap(x,y);\n  },\n\n  moveIndicator: function(x,y) {\n    var _this = this;\n\n    // Multiply map position by minimap scale.\n    // Map moves to negative coordinates,\n    // Minimap indicator moves positive\n    var minimapX = x * -(_this.minimapScale);\n    var minimapY = y * -(_this.minimapScale);\n\n    // If we don't know the indicator's current postion we get it\n    if (!_this.indicatorPosition) {\n      _this.indicatorPosition = Site.Map.getElemPosition(_this.minimapIndicator);\n    }\n\n    // Set new coordinates\n    _this.indicatorPosition[4] = minimapX;\n    _this.indicatorPosition[5] = minimapY;\n\n    // Apply new coordinates\n    _this.minimapIndicator.style.transform = 'matrix(' + _this.indicatorPosition.toString() + ')';\n  },\n\n};\n\nSite.init();\n"]}