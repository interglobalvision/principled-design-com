{"version":3,"sources":["main.js"],"names":["Site","mobileThreshold","init","_this","this","Router","$","window","resize","onResize","document","ready","Shapes","Map","Minimap","hover","console","log","css","fixWidows","each","string","html","replace","bind","location","hash","loadRoute","parseHash","on","removeClass","addClass","setMenuActive","$item","rawHash","substr","$mapPattern","$patterns","patternMin","patternMax","currentPattern","timer","interval","animating","showPattern","map","getElementById","addEventListener","startAnimation","stopAnimation","patternStyle","parseInt","Math","random","floor","changePattern","playAnimation","currentTime","Date","getTime","delta","startTime","requestAnimationFrame","cancelAnimationFrame","panZoneSize","panSpeed","panning","center","mouse","mapPosition","pointerInHeader","getWindowSize","setPanZones","handleMouseMove","body","stopPanning","bindHeaderMouseOver","width","innerWidth","height","innerHeight","x","y","panZones","up","min","max","down","left","right","event","clientX","clientY","isInsidePanZone","triggerPanning","stopPanEvent","mouseOnHeader","posX","posY","startPanEvent","pan","CustomEvent","detail","position","dispatchEvent","angle","angleFromCenter","translation","distanceFromCenter","getElemPosition","newX","cos","newY","sin","moveMap","style","transform","toString","moveIndicator","xs","pow","ys","distance","sqrt","dy","dx","theta","atan2","elem","transformMatrix","getComputedStyle","split","item","headerChilds","querySelectorAll","i","length","child","mouseEntersHeader","mouseLeavesHeader","minimapScale","indicatorPosition","minimapIndicator","bindClick","handleClick","pos","JSON","parse","attr","col","row","minimapX","minimapY"],"mappings":"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","file":"main.min.js","sourcesContent":["/* jshint browser: true, devel: true, indent: 2, curly: true, eqeqeq: true, futurehostile: true, latedef: true, undef: true, unused: true */\n/* global $, jQuery, document, Site, Modernizr */\n\nSite = {\n  mobileThreshold: 601,\n  init: function() {\n    var _this = this;\n\n    Site.Router.init();\n\n    $(window).resize(function(){\n      _this.onResize();\n    });\n\n    $(document).ready(function () {\n      Site.Shapes.init();\n      Site.Map.init();\n      Site.Minimap.init();\n\n      $('#header').hover( \n        function() {\n          console.log('mouseenter');\n          $('map-block-content').css('opacity','.3');\n        }, function() {\n          $('map-block-content').css('opacity','1');\n        }\n      );\n    });\n\n  },\n\n  onResize: function() {\n    var _this = this;\n\n  },\n\n  fixWidows: function() {\n    // utility class mainly for use on headines to avoid widows [single words on a new line]\n    $('.js-fix-widows').each(function(){\n      var string = $(this).html();\n      string = string.replace(/ ([^ ]*)$/,'&nbsp;$1');\n      $(this).html(string);\n    });\n  },\n};\n\nSite.Router = {\n  init: function() {\n    var _this = this;\n\n    _this.bind();\n\n    if (location.hash) {\n      _this.loadRoute(_this.parseHash(location.hash));\n    }\n  },\n\n  bind: function() {\n    var _this = this;\n\n    $(window).on('hashchange', function() {\n      _this.loadRoute(_this.parseHash(location.hash));\n    });\n\n  },\n\n  loadRoute: function(hash) {\n    var _this = this;\n\n    if (hash) {\n      $('.page-content').removeClass('page-content-active');\n      $('.page-content[data-slug=\"' + hash + '\"]').addClass('page-content-active');\n\n      _this.setMenuActive(hash);\n    }\n  },\n\n  setMenuActive: function(hash) {\n    var _this = this;\n\n    var $item = $('.header-menu-item[data-slug=\"' + hash + '\"]');\n\n    $('.header-menu-active').removeClass('header-menu-active');\n    $item.addClass('header-menu-active');\n  },\n\n  parseHash: function(rawHash) {\n    return rawHash.substr(3);\n  },\n};\n\nSite.Shapes = {\n  $mapPattern: $('.map-pattern'),\n  $patterns: [\n    $('#pattern-1'),\n    $('#pattern-2'),\n    $('#pattern-3'),\n    $('#pattern-4'),\n    $('#pattern-5'),\n  ],\n  patternMin: 0,\n  patternMax: 4,\n  currentPattern: 0,\n  timer: null,\n  interval: 500,\n  animating: false,\n\n  init: function() {\n    var _this = this;\n\n    _this.showPattern();\n\n    var map = document.getElementById('map');\n\n    map.addEventListener('startpan', function() {\n      _this.startAnimation();\n    });\n\n    map.addEventListener('stoppan', function() {\n      _this.stopAnimation();\n    });\n\n  },\n\n  showPattern: function() {\n    var _this = this;\n\n    // Choose 1 or 0\n    var patternStyle = parseInt(Math.random() * 2);\n\n    if (patternStyle === 1) {\n      // If 1, fill paths\n      $('#background-pattern-holder').addClass('fill-path');\n    } else {\n      // If 0, stroke paths\n      $('#background-pattern-holder').addClass('stroke-path');\n    }\n\n    // Assign random current pattern array index\n    _this.currentPattern = Math.floor(Math.random() * (_this.patternMax - _this.patternMin + 1)) + _this.patternMin;\n\n    // Show current pattern\n    _this.$patterns[_this.currentPattern].addClass('show');\n  },\n\n  changePattern: function() {\n    var _this = this;\n\n    // Hide current pattern\n    _this.$mapPattern.removeClass('show');\n\n    // Assign next current pattern\n    if (_this.currentPattern >= _this.patternMax) {\n      // If last pattern, start from min index\n      _this.currentPattern = _this.patternMin;\n    } else {\n      // Else, assign next index\n      _this.currentPattern++;\n    }\n\n    // Show new current pattern\n    _this.$patterns[_this.currentPattern].addClass('show');\n  },\n\n  playAnimation: function() {\n    var _this = this;\n\n    // Check is animating has been stopped; we do this here to fail faster\n    if (!_this.animating) {\n      return false;\n    }\n\n    var currentTime = new Date().getTime();\n    var delta = currentTime - _this.startTime;\n\n    // If interval has passed since start time\n    if (delta >= _this.interval) {\n\n      // Change the background pattern\n      _this.changePattern();\n\n      // Reset start time\n      _this.startTime = new Date().getTime();\n    }\n\n    // Play loop recursively\n    _this.timer = window.requestAnimationFrame(_this.playAnimation.bind(_this));\n  },\n\n  startAnimation: function() {\n    var _this = this;\n\n    // Set initial start time\n    _this.startTime = new Date().getTime() - _this.interval;\n\n    _this.animating = true;\n\n    // Initialize animation loop\n    _this.playAnimation();\n  },\n\n  stopAnimation: function() {\n    var _this = this;\n\n    _this.animating = false;\n\n    // Clear animation request\n    window.cancelAnimationFrame(_this.timer);\n  },\n};\n\nSite.Map = {\n  panZoneSize: 150, // in pixels\n  panSpeed: 0.04,\n  panning: false, // is it panning or not?\n  window: {},\n  center: {},\n  mouse: {},\n  mapPosition: false,\n  pointerInHeader: false,\n  init: function() {\n    var _this =  this;\n\n    // Set windowSize\n    _this.getWindowSize();\n\n    // Set map element\n    _this.map = document.getElementById('map');\n\n    // init pan zones\n    _this.setPanZones();\n\n    // Bind mouse position\n    document.addEventListener('mousemove', _this.handleMouseMove.bind(_this));\n\n    // Detect mouse outside window\n    document.body.addEventListener('mouseleave', _this.stopPanning.bind(_this));\n\n    _this.bindHeaderMouseOver();\n  },\n\n  getWindowSize: function() {\n    var _this =  this;\n\n    // Save window size\n    _this.window = {\n      width: window.innerWidth,\n      height: window.innerHeight,\n    };\n\n    // Save window center\n    _this.window.center = {\n      x: _this.window.width / 2,\n      y: _this.window.height / 2,\n    };\n\n  },\n\n  // Set Up, Left, Down and Right pan zones based on window size\n  setPanZones: function() {\n    var _this =  this;\n\n    _this.panZones = {\n      up: {\n        min: 0,\n        max: _this.panZoneSize,\n      },\n      down: {\n        min: _this.window.height - _this.panZoneSize,\n        max: _this.window.height,\n      },\n      left: {\n        min: 0,\n        max: _this.panZoneSize,\n      },\n      right: {\n        min: _this.window.width - _this.panZoneSize,\n        max: _this.window.width,\n      },\n    };\n\n  },\n\n  handleMouseMove: function(event) {\n    var _this =  this;\n\n    // Save mouse position\n    _this.mouse.x = event.clientX;\n    _this.mouse.y = event.clientY;\n\n\n    if (_this.isInsidePanZone() && !_this.panning) {\n      _this.triggerPanning(); // Trigger animation\n    } else if(_this.panning && !_this.isInsidePanZone()) {\n      _this.stopPanning(); // Stop animation\n    }\n\n  },\n\n  stopPanning: function() {\n    var _this =  this;\n\n    _this.panning = false;\n\n    _this.stopPanEvent();\n\n  },\n\n  // (Bool) check if mouse is inside any pan zone\n  isInsidePanZone: function() {\n    var _this =  this;\n\n    // Check if mouse is over header or it's childs\n    if(_this.mouseOnHeader) {\n      return false;\n    }\n\n    // Get mouse position\n    var posX = _this.mouse.x;\n    var posY = _this.mouse.y;\n\n    // Check if mouse is inside panZones\n    if ( (posX >= _this.panZones.left.min && posX <= _this.panZones.left.max) || // Left\n      (posX >= _this.panZones.right.min && posX <= _this.panZones.right.max) || // Right\n      (posY >= _this.panZones.up.min && posY <= _this.panZones.up.max) || // Up\n      (posY >= _this.panZones.down.min && posY <= _this.panZones.down.max) ) //  Down\n    {\n      return true;\n    }\n\n    return false;\n\n  },\n\n  // Trigger panning animation\n  triggerPanning: function() {\n    var _this =  this;\n\n    _this.panning = true;\n\n    _this.startPanEvent();\n\n    window.requestAnimationFrame(_this.pan.bind(_this));\n\n  },\n\n  startPanEvent: function() {\n    var _this =  this;\n\n    var startPanEvent = new CustomEvent('startpan', {\n      detail: {\n        map: {\n          position: {\n            x: _this.mapPosition[4],\n            y: _this.mapPosition[5],\n          },\n        },\n      },\n    });\n\n    _this.map.dispatchEvent(startPanEvent);\n\n  },\n\n  stopPanEvent: function() {\n    var _this =  this;\n\n    var stopPanEvent = new CustomEvent('stoppan', {\n      detail: {\n        map: {\n          position: {\n            x: _this.mapPosition[4],\n            y: _this.mapPosition[5],\n          },\n        },\n      },\n    });\n\n    _this.map.dispatchEvent(stopPanEvent);\n\n  },\n\n  // Main panning logic\n  pan: function() {\n    var _this =  this;\n\n    // Check is panning has been stopped; we do this here to fail faster\n    if (!_this.panning) {\n      return false;\n    }\n\n    // Get the angle between center and mouse position\n    var angle = _this.angleFromCenter();\n\n    // Get the translation value based on mouse position from the center and speed\n    var translation = _this.distanceFromCenter() * _this.panSpeed;\n\n    // If we don't know the map's current postion we get it\n    if (!_this.mapPosition) {\n      _this.mapPosition = _this.getElemPosition(_this.map);\n    }\n\n    // Get new coordinates based on the angle and the translation value\n    var newX = _this.mapPosition[4] + (translation * Math.cos(angle));\n    var newY = _this.mapPosition[5] + (translation * Math.sin(angle));\n\n    // Check for left limit\n    if (newX >= 0) {\n      newX = 0;\n    }\n\n    // Check for right limit\n    if (newX <= _this.window.width * -2) {\n      newX = _this.window.width * -2;\n    }\n\n    // Check for upper limit\n    if (newY >= 0) {\n      newY = 0;\n    }\n\n    // Check for bottom limit\n    if (newY <= _this.window.height * -2) {\n      newY = _this.window.height * -2;\n    }\n\n    // Move the map\n    _this.moveMap(newX,newY);\n\n    // Animate recursevly\n    window.requestAnimationFrame(_this.pan.bind(_this));\n\n  },\n\n  // Move the map to given coordinates\n  moveMap: function(x,y) {\n    var _this =  this;\n\n    // If we don't know the map's current postion we get it\n    if (!_this.mapPosition) {\n      _this.mapPosition = _this.getElemPosition(_this.map);\n    }\n\n    // Set new coordinates\n    _this.mapPosition[4] = x;\n    _this.mapPosition[5] = y;\n\n    // Apply new coordinates\n    _this.map.style.transform = 'matrix(' + _this.mapPosition.toString() + ')';\n\n    // Move minimap position indicator\n    Site.Minimap.moveIndicator(x,y);\n  },\n\n  // Return distance between center and mouse positon in pixels\n  distanceFromCenter: function() {\n    var _this = this;\n\n    var xs = Math.pow(_this.window.center.x - _this.mouse.x, 2);\n    var ys = Math.pow(_this.window.center.y - _this.mouse.y, 2);\n    var distance = Math.sqrt(xs + ys);\n\n    return distance;\n  },\n\n  // Return angle in rad from center of the window and mouse position relative to X-axis\n  angleFromCenter: function() {\n    var _this = this;\n\n    var dy = _this.window.center.y - this.mouse.y;\n    var dx = _this.window.center.x - this.mouse.x;\n\n    var theta = Math.atan2(dy, dx); // range (-PI, PI]\n\n    return theta;\n  },\n\n  // Return current map postion\n  getElemPosition: function(elem) {\n    var _this = this;\n\n    // Get current element position (transform values)\n    var transformMatrix = getComputedStyle(elem).transform; // Returns a string like \"matrix(0,0,0,0,0,0)\"\n\n    // Get only the values\n    transformMatrix = transformMatrix.replace('matrix(','').replace(')', ''); // Returns a string like \"0,0,0,0,0,0\"\n\n    // Make it into an array\n    transformMatrix = transformMatrix.split(', ').map( function(item) {\n      return parseInt(item, 10);\n    }); // Returns an array like [0,0,0,0,0,0]\n\n    return transformMatrix;\n  },\n\n  bindHeaderMouseOver: function() {\n    var _this =  this;\n\n    // Detect mouse inside #header\n    var headerChilds = document.querySelectorAll('#header > *');\n\n    for (var i = 0; i < headerChilds.length; i++) {\n      var child = headerChilds[i];\n\n      child.addEventListener('mouseenter', _this.mouseEntersHeader.bind(_this));\n      child.addEventListener('mouseleave', _this.mouseLeavesHeader.bind(_this));\n    }\n\n  },\n\n  mouseEntersHeader: function() {\n    var _this = this;\n\n    _this.mouseOnHeader = true;\n  },\n\n  mouseLeavesHeader: function() {\n    var _this = this;\n\n    _this.mouseOnHeader = false;\n  },\n\n};\n\n\nSite.Minimap = {\n  minimapScale: .03,\n  indicatorPosition: false,\n  init: function() {\n    var _this = this;\n\n    // Set indicator element\n    _this.minimapIndicator = document.getElementById('minimap-indicator');\n\n    _this.bindClick();\n  },\n\n  bindClick: function() {\n    var _this = this;\n\n    // Bind click on minimap buttons\n    $('.minimap-button').on('click', function() {\n      // HANDLE IT\n      _this.handleClick(this);\n    });\n  },\n\n  handleClick: function(elem) {\n    var _this = this;\n\n    // Parse targets position JSON from data attr\n    var pos = JSON.parse($(elem).attr('data-pos'));\n    var col = pos.col;\n    var row = pos.row;\n\n    // Multiply positions by window sizes to get new map coordinates\n    var x = col * Site.Map.window.width * -1;\n    var y = row * Site.Map.window.height * -1;\n\n    // Move map to new coordinates\n    // moveIndicator is called by this function\n    Site.Map.moveMap(x,y);\n  },\n\n  moveIndicator: function(x,y) {\n    var _this = this;\n\n    // Multiply map position by minimap scale.\n    // Map moves to negative coordinates,\n    // Minimap indicator moves positive\n    var minimapX = x * -(_this.minimapScale);\n    var minimapY = y * -(_this.minimapScale);\n\n    // If we don't know the indicator's current postion we get it\n    if (!_this.indicatorPosition) {\n      _this.indicatorPosition = Site.Map.getElemPosition(_this.minimapIndicator);\n    }\n\n    // Set new coordinates\n    _this.indicatorPosition[4] = minimapX;\n    _this.indicatorPosition[5] = minimapY;\n\n    // Apply new coordinates\n    _this.minimapIndicator.style.transform = 'matrix(' + _this.indicatorPosition.toString() + ')';\n  },\n\n};\n\nSite.init();\n"]}